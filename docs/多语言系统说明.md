# 多语言系统说明

## 概述

本项目实现了完整的多语言系统，支持中文和英文两种语言。开发时在 `src/locales` 目录中编写多语言文件，编译后会自动生成到 `data/locales` 目录中，前端通过 fetch 请求获取多语言数据。

## 目录结构

```
src/
  locales/
    zh-CN.json    # 中文语言文件（开发时编辑）
    en-US.json    # 英文语言文件（开发时编辑）

data/
  locales/
    zh-CN.json    # 编译后的中文文件
    en-US.json    # 编译后的英文文件
```

## 使用方法

### 1. 添加新的语言键

在 `src/locales/zh-CN.json` 中添加新的中文翻译：

```json
{
  "NEW_KEY": "新的中文翻译"
}
```

### 2. 运行编译脚本

执行以下命令生成多语言文件：

```bash
# 只生成多语言文件（带缓存检查）
npm run generate-locales

# 监听模式（开发时使用）
npm run generate-locales:watch

# 生成所有文件（包括文章和多语言）
npm run generate-all
```

### 3. 自动生成英文翻译

脚本会自动检测中文文件中新增的键，并在英文文件中生成对应的占位符翻译：

```json
{
  "NEW_KEY": "[EN] 新的中文翻译"
}
```

### 4. 缓存机制

脚本使用 MD5 哈希值检测文件变化，只在以下情况重新生成：
- `data/locales` 目录不存在
- 源文件内容发生变化
- 缓存文件不存在或损坏

缓存文件位置：`data/.locales-cache.json`

### 5. 开发模式监听

在开发过程中，可以使用监听模式自动编译：

```bash
npm run generate-locales:watch
```

监听模式会：
- 实时监听 `src/locales` 目录中的文件变化
- 自动重新生成多语言文件
- 在控制台显示变化信息

### 6. 前端使用

前端通过 `languageService` 获取翻译：

```typescript
import { languageService } from '@/services/languageService';

// 获取当前语言的文本
const text = languageService.getText('NEW_KEY');

// 异步获取文本（确保语言文件已加载）
const text = await languageService.getTextAsync('NEW_KEY');

// 带变量的文本
const text = languageService.getText('SEARCH_RESULTS_COUNT', { count: 5 });
```

## 脚本功能

### generateLocales.js

- 将 `src/locales` 中的文件拷贝到 `data/locales`
- 自动检测中文文件中新增的键
- 在英文文件中生成对应的占位符翻译
- 输出统计信息（键数量、缺失翻译等）
- **缓存机制**：只在文件有变化时才重新生成
- **监听模式**：开发时自动监听文件变化并重新编译

### 统计信息示例

```
🌐 Generating locales...
✓ Generated: /path/to/data/locales/zh-CN.json
✓ Generated: /path/to/data/locales/en-US.json
✅ Locales generation completed!
📊 Statistics:
   - Chinese keys: 115
   - English keys: 115
   - Missing translations: 1
   - Missing keys: NEW_KEY
```

## 开发规范

### 1. 键命名规范

- 使用大写字母和下划线
- 使用描述性的名称
- 按功能模块分组

示例：
```json
{
  "SITE_TITLE": "网站标题",
  "NAV_HOME": "导航首页",
  "BUTTON_SUBMIT": "提交按钮"
}
```

### 2. 变量替换

支持在翻译中使用变量：

```json
{
  "SEARCH_RESULTS_COUNT": "找到 {{count}} 篇文章",
  "ARTICLE_READ_TIME": "预计阅读时间 {{minutes}} 分钟"
}
```

使用方式：
```typescript
const text = languageService.getText('SEARCH_RESULTS_COUNT', { count: 10 });
```

### 3. 占位符翻译

当英文翻译缺失时，脚本会生成占位符格式：

```json
{
  "NEW_KEY": "[EN] 新的中文翻译"
}
```

开发者需要手动完善英文翻译。

## 故障排除

### 1. 语言文件无法加载

检查：
- 是否运行了 `npm run generate-locales`
- `data/locales` 目录是否存在
- 文件格式是否正确（JSON）

### 2. 翻译不显示

检查：
- 键名是否正确
- 是否在正确的语言文件中添加了翻译
- 是否重新运行了编译脚本

### 3. 变量替换不工作

检查：
- 变量名是否与 JSON 中的占位符匹配
- 变量值是否为字符串或数字

## 开发工作流程

### 正常开发流程

1. **修改多语言文件**：在 `src/locales/zh-CN.json` 中添加新的翻译
2. **运行编译**：执行 `npm run generate-locales` 或 `npm run generate-all`
3. **验证结果**：检查 `data/locales` 目录中的生成文件

### 开发模式流程

1. **启动监听**：执行 `npm run generate-locales:watch`
2. **修改文件**：在 `src/locales` 中修改多语言文件
3. **自动编译**：脚本自动检测变化并重新生成
4. **实时预览**：前端自动获取最新的多语言数据

### 集成开发流程

使用 `npm run dev` 启动开发服务器时，会自动：
- 生成所有必要文件（文章、多语言等）
- 启动多语言文件监听
- 启动 Vite 开发服务器

## 扩展支持

如需添加更多语言，可以：

1. 在 `src/locales` 中添加新的语言文件（如 `ja-JP.json`）
2. 修改 `scripts/generateLocales.js` 脚本支持新语言
3. 更新 `languageService.ts` 中的语言类型定义
4. 在 UI 中添加语言切换选项 