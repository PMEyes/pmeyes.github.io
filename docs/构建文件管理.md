# 📦 构建文件管理

## 概述

本项目采用自动构建和部署策略，构建文件（`dist` 目录）不包含在 Git 仓库中，而是通过 GitHub Actions 自动生成和部署。

## 构建文件策略

### ❌ 不包含在 Git 仓库中的文件

- `dist/` - 构建输出目录
- `node_modules/` - 依赖包目录
- `.env*` - 环境变量文件
- `*.log` - 日志文件

### ✅ 包含在 Git 仓库中的文件

- 源代码文件（`src/`）
- 配置文件（`package.json`, `vite.config.ts` 等）
- 文档文件（`docs/`）
- 文章内容（`articles/`）
- 静态资源（`public/`）

## 构建流程

### 本地开发

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 构建项目（本地测试）
npm run build

# 预览构建结果
npm run preview
```

### 自动部署

1. **推送代码**：将代码推送到 `main` 分支
2. **自动构建**：GitHub Actions 自动运行构建流程
3. **自动部署**：构建完成后自动部署到 GitHub Pages

## 构建文件说明

### dist/ 目录结构

```
dist/
├── index.html              # 主页面
├── 404.html               # 404 页面（SPA 路由处理）
├── assets/                # 静态资源
│   ├── css/              # 样式文件
│   ├── js/               # JavaScript 文件
│   └── images/           # 图片文件
├── favicon.ico           # 网站图标
├── logo.jpg              # Logo 图片
└── CNAME                 # 自定义域名配置
```

### 构建优化

- **代码分割**：vendor 和 router 代码分别打包
- **资源压缩**：CSS 和 JS 文件自动压缩
- **缓存优化**：文件名包含哈希值，便于缓存更新
- **模块化**：使用 ES 模块格式

## 部署配置

### GitHub Pages 设置

- **Source**：Deploy from a branch
- **Branch**：`gh-pages`
- **Folder**：`/ (root)`

### GitHub Actions 工作流

```yaml
name: Deploy to GitHub Pages
on:
  push:
    branches: [ main ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Generate articles
        run: npm run generate-articles
      
      - name: Build
        env:
          NODE_ENV: production
        run: npm run build
      
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
```

## 优势

### 1. 仓库大小优化

- 不包含构建文件，保持仓库轻量
- 减少 Git 历史记录大小
- 提高克隆和拉取速度

### 2. 自动化部署

- 每次推送代码自动构建和部署
- 确保部署的代码与源代码一致
- 减少手动操作错误

### 3. 环境一致性

- 构建环境统一（GitHub Actions）
- 避免本地环境差异导致的问题
- 确保生产环境稳定性

## 故障排除

### 问题 1：构建失败

**检查步骤**：
1. 查看 GitHub Actions 日志
2. 确认所有依赖已安装
3. 检查 TypeScript 编译错误

### 问题 2：部署失败

**检查步骤**：
1. 确认 GitHub Pages 设置正确
2. 检查 `gh-pages` 分支是否存在
3. 验证构建输出目录内容

### 问题 3：本地构建问题

**检查步骤**：
1. 清理并重新安装依赖：`rm -rf node_modules && npm install`
2. 清理构建缓存：`rm -rf dist && npm run build`
3. 检查 Node.js 版本兼容性

## 最佳实践

### 1. 开发流程

```bash
# 开发时
npm run dev

# 提交前测试
npm run build
npm run preview

# 提交代码
git add .
git commit -m "描述更改"
git push origin main
```

### 2. 部署监控

- 定期检查 GitHub Actions 状态
- 监控部署时间和成功率
- 及时处理构建错误

### 3. 版本管理

- 使用语义化版本号
- 保持提交信息清晰
- 定期清理不必要的分支

---

💡 **提示**：如果您需要本地测试构建结果，可以使用 `npm run preview` 命令在本地预览构建后的网站。 