# 🚀 完整部署指南

## 概述

本项目已配置为支持 GitHub Pages 自动部署，使用 Husky Git 钩子实现推送时自动构建和部署。当您推送代码到 `main` 分支时，会自动触发构建、部署和文件提交。

## 🎯 快速开始

### 一键部署（推荐）

```bash
# 1. 提交代码
git add .
git commit -m "更新代码"

# 2. 推送到 main 分支（自动触发部署）
git push origin main
```

推送后会自动执行：
1. ✅ 构建项目（清理 dist 目录）
2. ✅ 部署到 GitHub Pages
3. ✅ 自动提交生成的文件
4. ✅ 推送所有更改到远程仓库

## 📋 部署配置

### 1. GitHub Pages 设置

1. 进入 GitHub 仓库页面
2. 点击 "Settings" 标签
3. 在左侧菜单找到 "Pages"
4. 配置设置：
   - **Source**: Deploy from a branch
   - **Branch**: `gh-pages`
   - **Folder**: `/ (root)`
5. 点击 "Save"

### 2. 项目配置

- **Base URL**: 生产环境使用 `/pmeyes.github.io/`，开发环境使用 `/`
- **构建输出目录**: `dist/`
- **部署分支**: `gh-pages`
- **自动部署**: 使用 Husky Git 钩子

## 🔧 自动部署机制

### Git 钩子配置 (Husky)

项目使用 [Husky](https://typicode.github.io/husky/) 管理 Git 钩子：

- **钩子文件**: `.husky/pre-push`
- **触发条件**: 在 `main` 分支上执行 `git push`
- **执行流程**: 构建 → 部署 → 自动提交文件

### 部署流程

1. **检测分支** - 确认在 main 分支上
2. **构建项目** - 清理 dist 目录并构建
3. **部署到 GitHub Pages** - 使用 gh-pages 部署
4. **自动提交文件** - 检查并提交部署过程中生成的文件
5. **推送代码** - 将更改推送到远程仓库

## 🛠️ 手动部署

### 方法 1：使用 npm 脚本

```bash
# 构建、部署并自动提交文件
npm run deploy
```

### 方法 2：使用部署脚本

```bash
# 运行完整部署脚本
./scripts/deploy.sh
```

### 方法 3：分步部署

```bash
# 1. 构建项目
npm run build

# 2. 部署到 GitHub Pages
gh-pages -d dist

# 3. 提交生成的文件
git add .
git commit -m "chore: 提交部署生成的文件 [skip ci]"
git push origin main
```

## 📁 脚本说明

### 可用脚本

- `npm run clean` - 删除 dist 目录
- `npm run build` - 构建项目（包含清理步骤）
- `npm run deploy` - 构建、部署并自动提交文件
- `npm run prepare` - 安装 Husky 钩子

### 部署脚本

- `scripts/deploy.sh` - 完整的部署脚本
- `.husky/pre-push` - Git pre-push 钩子脚本

## 🔍 验证部署

### 检查部署状态

1. **GitHub Actions**: 查看构建日志
2. **GitHub Pages**: 检查部署状态
3. **网站访问**: 访问 https://pmeyes.github.io

### 验证页面

部署完成后，访问以下地址验证：

- **主页面**: https://pmeyes.github.io/
- **文章页面**: https://pmeyes.github.io/articles
- **关于页面**: https://pmeyes.github.io/about

## 🚨 故障排除

### 常见问题

#### 1. 部署失败
**症状**: push 操作被阻止
**解决**:
- 检查构建日志
- 确保所有依赖已安装
- 验证 GitHub Pages 设置

#### 2. 页面显示 404
**症状**: 访问网站显示 404 错误
**解决**:
- 检查 GitHub Pages 设置是否正确
- 确认 `gh-pages` 分支存在
- 验证构建是否成功

#### 3. 路由不工作
**症状**: 刷新页面后路由失效
**解决**:
- 确认 404.html 文件存在
- 检查 index.html 中的路由处理脚本
- 验证 HashRouter 配置

#### 4. 资源加载失败
**症状**: CSS/JS 文件加载失败
**解决**:
- 检查 vite.config.ts 中的 base 配置
- 确认资源路径正确
- 验证构建输出

### 调试步骤

1. **检查构建输出**:
   ```bash
   npm run build
   ls -la dist/
   ```

2. **本地预览**:
   ```bash
   npm run build
   npm run preview
   ```

3. **检查 Git 状态**:
   ```bash
   git status
   git log --oneline -5
   ```

4. **查看部署日志**:
   - GitHub Actions 日志
   - 浏览器开发者工具

## 🔧 环境配置

### 环境变量

- `NODE_ENV`: 控制构建模式（development/production）
- `GITHUB_TOKEN`: GitHub Actions 使用的认证令牌（自动提供）

### 构建优化

- **代码分割**: vendor 和 router 代码分别打包
- **资源压缩**: 启用 gzip 和 brotli 压缩
- **缓存优化**: 合理的缓存策略

## 📊 性能优化

### 构建优化

- 代码分割：vendor 和 router 代码分别打包
- 资源压缩：启用 gzip 和 brotli 压缩
- 缓存优化：合理的缓存策略

### 运行时优化

- 懒加载：路由级别的代码分割
- 图片优化：自动压缩和格式转换
- 预加载：关键资源预加载

## ⚠️ 注意事项

1. **分支要求**: 确保在 main 分支上工作才能触发自动部署
2. **构建清理**: 部署前会自动清理旧的构建文件
3. **失败处理**: 如果部署失败，push 操作会被阻止
4. **自动提交**: 部署后会自动提交生成的文件
5. **CI/CD 标记**: 使用 `[skip ci]` 标记避免触发 CI/CD 循环
6. **钩子安装**: Husky 钩子会在项目安装时自动设置

## 🔄 工作流程

### 开发流程

1. **日常开发**:
   ```bash
   npm run dev          # 开发模式
   git add .            # 暂存更改
   git commit -m "更新"  # 提交更改
   git push origin main # 推送并自动部署
   ```

2. **手动部署**:
   ```bash
   npm run deploy       # 手动触发部署
   ```

### 维护流程

1. **定期更新**: 更新依赖包
2. **性能监控**: 监控构建和部署性能
3. **安全检查**: 定期检查安全漏洞
4. **备份重要文件**: 确保重要文件不会被意外删除

## 📞 联系支持

如果遇到部署问题，请：

1. 检查 GitHub Actions 日志
2. 查看项目文档
3. 提交 Issue 描述问题
4. 参考故障排除部分

---

🎉 **恭喜！您的项目已完全配置好自动部署功能！**

现在您只需要 `git push origin main` 就能自动完成构建、部署和文件提交的完整流程。 