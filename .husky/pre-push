# è·å–å½“å‰åˆ†æ”¯å
current_branch=$(git symbolic-ref --short HEAD)

# æ£€æŸ¥æ˜¯å¦åœ¨ main åˆ†æ”¯ä¸Š
if [ "$current_branch" = "main" ]; then
    # æ£€æŸ¥æœ€è¿‘çš„æäº¤ä¿¡æ¯ï¼Œé¿å…é€’å½’è§¦å‘
    last_commit_msg=$(git log -1 --pretty=%B)
    if [[ "$last_commit_msg" == *"[skip ci]"* ]] || [[ "$last_commit_msg" == *"è‡ªåŠ¨æäº¤éƒ¨ç½²ç”Ÿæˆçš„æ–‡ä»¶"* ]]; then
        echo "â„¹ï¸  æ£€æµ‹åˆ°è‡ªåŠ¨æäº¤ï¼Œè·³è¿‡éƒ¨ç½²ä»¥é¿å…é€’å½’"
        exit 0
    fi
    
    echo "ğŸš€ æ£€æµ‹åˆ° main åˆ†æ”¯ pushï¼Œå¼€å§‹è‡ªåŠ¨éƒ¨ç½²..."
    
    # æ‰§è¡Œéƒ¨ç½²è„šæœ¬
    npm run deploy
    
    if [ $? -eq 0 ]; then
        echo "âœ… éƒ¨ç½²æˆåŠŸï¼"
        
        # æ£€æŸ¥æ˜¯å¦æœ‰æ–°æ–‡ä»¶éœ€è¦æäº¤
        if [ -n "$(git status --porcelain)" ]; then
            echo "ğŸ“ å‘ç°æ–°æ–‡ä»¶ï¼Œæ­£åœ¨æäº¤..."
            git add .
            git commit -m "chore: è‡ªåŠ¨æäº¤éƒ¨ç½²ç”Ÿæˆçš„æ–‡ä»¶ [skip ci]"
            echo "âœ… æ–‡ä»¶å·²æäº¤"
        fi
    else
        echo "âŒ éƒ¨ç½²å¤±è´¥ï¼Œè¯·æ£€æŸ¥é”™è¯¯ä¿¡æ¯"
        exit 1
    fi
else
    echo "â„¹ï¸  å½“å‰åˆ†æ”¯: $current_branchï¼Œè·³è¿‡è‡ªåŠ¨éƒ¨ç½²"
fi 